---
title: "MetodologÃ­a de Pentesting - GuÃ­a Completa"
date: Tue Dec 10 2025 00:00:00 GMT+0100 (Central European Standard Time)
categories: [Apuntes, MetodologÃ­a]
tags: [metodologia, reconocimiento, enumeracion, ptes, oscp, red-team, nmap, apuntes, pentesting]
image: /assets/img/cabeceras/2025-12-10-metodologia-pentesting.png
---

# MetodologÃ­a de Pentesting - GuÃ­a Completa

## ğŸ¯ IntroducciÃ³n

Esta guÃ­a cubre la metodologÃ­a estÃ¡ndar de pentesting siguiendo el **PTES (Penetration Testing Execution Standard)** y las mejores prÃ¡cticas utilizadas en certificaciones como **OSCP**, **OSEP** y **OSWE**.

### Â¿Por quÃ© seguir una metodologÃ­a?

- âœ… **Estructura**: Evita pasar por alto vectores de ataque
- âœ… **Reproducibilidad**: Los resultados pueden ser verificados
- âœ… **DocumentaciÃ³n**: Facilita la generaciÃ³n de informes profesionales
- âœ… **Eficiencia**: Optimiza el tiempo durante evaluaciones

---

## ğŸ” Fases del Pentesting

### 1. Pre-Engagement (PreparaciÃ³n)
- Definir alcance y objetivos
- Firmar acuerdos legales (NDA, RoE)
- Establecer canales de comunicaciÃ³n

### 2. Intelligence Gathering (Reconocimiento)
- **Pasivo**: OSINT, bÃºsqueda de informaciÃ³n pÃºblica
- **Activo**: Escaneo de puertos, enumeraciÃ³n de servicios

### 3. Threat Modeling (Modelado de amenazas)
- Identificar activos crÃ­ticos
- Analizar superficie de ataque
- Priorizar objetivos

### 4. Vulnerability Analysis (AnÃ¡lisis de vulnerabilidades)
- IdentificaciÃ³n de vulnerabilidades
- ValidaciÃ³n manual
- EvaluaciÃ³n de impacto

### 5. Exploitation (ExplotaciÃ³n)
- Desarrollo o uso de exploits
- ObtenciÃ³n de acceso inicial
- Pivoting y movimiento lateral

### 6. Post-Exploitation (Post-explotaciÃ³n)
- Escalada de privilegios
- Persistencia
- ExfiltraciÃ³n de datos (en entornos de prueba)

### 7. Reporting (DocumentaciÃ³n)
- Informe ejecutivo
- Informe tÃ©cnico detallado
- Recomendaciones de remediaciÃ³n

---

## ğŸš€ Reconocimiento Inicial

### Escaneo con Nmap

**Nmap** es la herramienta fundamental para el descubrimiento de hosts y servicios.

#### Escaneo bÃ¡sico con detecciÃ³n de servicios

```bash
# Escaneo completo con scripts y detecciÃ³n de versiÃ³n
nmap -sC -sV -O 10.10.16.25 -A -T4 -Pn

# ParÃ¡metros:
# -sC: Scripts por defecto de NSE
# -sV: DetecciÃ³n de versiones
# -O: DetecciÃ³n de sistema operativo
# -A: Modo agresivo (incluye -O, -sV, -sC y traceroute)
# -T4: Velocidad de escaneo (0-5)
# -Pn: No hacer ping previo (Ãºtil con firewalls)
```

#### Escaneo rÃ¡pido de todos los puertos

```bash
# Escaneo SYN de todos los puertos TCP (requiere root)
sudo nmap -p- --open -sS --min-rate 5000 -n -Pn 192.168.191.220 -oG allPorts

# ParÃ¡metros:
# -p-: Escanear los 65535 puertos
# --open: Mostrar solo puertos abiertos
# -sS: SYN Scan (sigiloso, no completa handshake TCP)
# --min-rate: Paquetes por segundo (ajustar segÃºn red)
# -n: No resolver DNS (mÃ¡s rÃ¡pido)
# -oG: Salida en formato Grepable
```

**ğŸ’¡ Tip**: El flag `-sS` (SYN Scan) es mÃ¡s sigiloso que `-sT` (Connect Scan) porque no completa el three-way handshake, dejando menos evidencia en logs.

#### Escaneo dirigido de puertos especÃ­ficos

```bash
# Escaneo detallado de puertos encontrados
sudo nmap -sCV -A -Pn -p80,3389,445 192.168.245.227 -oN targeted

# ParÃ¡metros:
# -sCV: Equivalente a -sC -sV
# -oN: Salida en formato normal (legible)
```

#### Nmap con proxychains

```bash
# Ãštil para pivotar a travÃ©s de SOCKS proxy
proxychains nmap -sT -sV -Pn -T5 172.16.1.20

# Nota: Con proxychains SOLO podemos usar -sT (Connect scan)
# No funciona -sS porque requiere raw sockets
```

**âš ï¸ Advertencia**: `-T5` es muy ruidoso y puede ser detectado fÃ¡cilmente por IDS/IPS. Usar `-T3` o `-T4` para ser mÃ¡s discreto.

---

### Masscan - Escaneo Ultra-RÃ¡pido

**Masscan** es ideal para escaneos rÃ¡pidos de grandes rangos de red.

```bash
# Escaneo de todos los puertos TCP y UDP
sudo masscan -e tun0 -p1-65535,U:1-65535 --rate 500 192.168.248.151

# ParÃ¡metros:
# -e: Especificar interfaz de red
# -p: Rango de puertos TCP
# U:1-65535: Rango de puertos UDP
# --rate: Paquetes por segundo

# Solo puertos abiertos con velocidad controlada
sudo masscan -e tun0 --open -p1-65535 --max-rate 1000 10.10.10.50
```

**ğŸ”¥ ComparaciÃ³n Nmap vs Masscan**:
- **Masscan**: Velocidad extrema, ideal para descubrimiento inicial
- **Nmap**: MÃ¡s preciso, mejor para enumeraciÃ³n detallada
- **Estrategia recomendada**: Masscan primero â†’ Nmap despuÃ©s en puertos encontrados

---

### Rustscan - Alternativa Moderna

**Rustscan** combina velocidad con la precisiÃ³n de Nmap.

```bash
# Escaneo completo con scripts de Nmap
rustscan --addresses 192.168.127.117 --ulimit 5000 -- -A -sC -Pn -sV -T 1500

# ParÃ¡metros antes de '--': Rustscan
# ParÃ¡metros despuÃ©s de '--': Pasados directamente a Nmap
```

**ğŸ’¡ Ventajas de Rustscan**:
- Escrito en Rust (muy rÃ¡pido)
- Escanea todos los puertos en segundos
- AutomÃ¡ticamente invoca Nmap para detalles
- Ideal para CTFs y exÃ¡menes OSCP

---

## ğŸ“Š EnumeraciÃ³n de Servicios EspecÃ­ficos

### DNS (Puerto 53)

```bash
# Descubrir dominios con nslookup
nslookup
> server 10.129.227.211
> 10.129.227.211

# Consultas especÃ­ficas con dig
dig @10.129.227.211 cronos.htb ns    # Name servers
dig @10.129.227.211 cronos.htb mx    # Mail servers

# Ataque de transferencia de zona (Zone Transfer)
dig @10.129.227.211 cronos.htb axfr
```

**ğŸ¯ Â¿QuÃ© es Zone Transfer?**

Un Zone Transfer (AXFR) es una tÃ©cnica donde un servidor DNS transfiere toda su base de datos de zona a otro servidor. Si estÃ¡ mal configurado, un atacante puede obtener:
- Todos los subdominios
- Direcciones IP internas
- TopologÃ­a de red

**ğŸ›¡ï¸ Contramedida**: Restringir transferencias de zona solo a servidores autorizados.

---

### Dirsearch - EnumeraciÃ³n de Directorios Web

```bash
# Escaneo bÃ¡sico de directorios
dirsearch -u http://cozyhosting.htb

# ParÃ¡metros Ãºtiles:
# -w: Wordlist personalizada
# -e: Extensiones (php,txt,html)
# -t: Threads (hilos concurrentes)
# -r: Recursivo
# --exclude-status: Excluir cÃ³digos HTTP
```

**ğŸ’¡ Tip**: Combinar con wordlists especÃ­ficas segÃºn tecnologÃ­a detectada:
- **PHP**: `/usr/share/seclists/Discovery/Web-Content/PHP.fuzz.txt`
- **ASP.NET**: `/usr/share/seclists/Discovery/Web-Content/IIS.fuzz.txt`
- **General**: `/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt`

---

### Wfuzz - Fuzzing Avanzado

#### EnumeraciÃ³n de subdominios

```bash
# Descubrir subdominios mediante fuzzing de cabecera Host
wfuzz -c -f sub-fighter \
  -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt \
  -u 'http://analytical.htb' \
  -H "Host: FUZZ.analytical.htb" \
  --hc 302

# ParÃ¡metros:
# -c: Salida con colores
# -f: Guardar resultados en archivo
# -H: Cabecera HTTP personalizada
# --hc: Ocultar cÃ³digo HTTP (302 en este caso)
# --hl: Ocultar por longitud de respuesta
# --hw: Ocultar por nÃºmero de palabras
```

**ğŸ” TÃ©cnicas de filtrado**:
```bash
# Filtrar por cÃ³digo HTTP
--hc 404,403

# Filtrar por tamaÃ±o de respuesta
--hs 1234

# Filtrar por lÃ­neas
--hl 42

# Mostrar solo cÃ³digo 200
--sc 200
```

---

### Gobuster - Alternativa Eficiente

```bash
# EnumeraciÃ³n de directorios
gobuster dir -w /usr/share/dirb/wordlists/common.txt \
  -u http://192.168.239.225:8090/backend/default/ \
  -x php,txt

# EnumeraciÃ³n de subdominios (vhost)
gobuster vhost --append-domain \
  -u http://bart.htb \
  -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt \
  -t 200

# A travÃ©s de proxy (Ãºtil para pivoting)
gobuster dir --proxy socks5://127.0.0.1:1080 \
  --url http://172.16.1.13/ \
  -w /usr/share/wordlists/dirb/common.txt
```

**âš¡ OptimizaciÃ³n de rendimiento**:
- `-t 50`: Aumentar threads (por defecto 10)
- `--delay 100ms`: AÃ±adir delay para evitar rate limiting
- `--timeout 10s`: Timeout personalizado

---

### Feroxbuster - Fuzzing Recursivo

```bash
# Escaneo recursivo con filtros
feroxbuster \
  -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt \
  -u http://milan:60001 \
  --filter-status 404,500,200 \
  -r \
  -d 3

# ParÃ¡metros:
# -r: Recursivo
# -d: Profundidad de recursiÃ³n
# --filter-status: CÃ³digos HTTP a filtrar
# -x: Extensiones (php,html,txt)
```

**ğŸ¯ Casos de uso**:
- **CMS**: Buscar paneles de administraciÃ³n
- **APIs**: Endpoints no documentados
- **Archivos de backup**: .bak, .old, .backup

---

### FFuf - Fuzzer Moderno

```bash
# Fuzzing de directorios
ffuf -c -w /usr/share/seclists/Discovery/Web-Content/common.txt \
  -u http://192.168.228.143/FUZZ

# Fuzzing de subdominios
ffuf -u http://analysis.htb/ \
  -H "Host: FUZZ.analysis.htb" \
  -w /usr/share/seclists/Discovery/DNS/subdomain-megalist.txt

# Fuzzing de parÃ¡metros GET
ffuf -u http://target.com/page?FUZZ=value \
  -w wordlist.txt \
  -fs 4242  # Filtrar por tamaÃ±o
```

**ğŸ’¡ Filtros avanzados de FFuf**:
```bash
# Filtrar por tamaÃ±o
-fs 1234

# Filtrar por nÃºmero de palabras
-fw 42

# Filtrar por lÃ­neas
-fl 10

# Filtrar por cÃ³digo
-fc 404,403

# Match (mostrar solo)
-ms 1234  # Por tamaÃ±o
-mc 200,301  # Por cÃ³digo
```

---

## ğŸ› ï¸ Herramientas Esenciales

### Scripts de Nmap

```bash
# Listar categorÃ­as de scripts disponibles
locate .nse | xargs grep "categories" | grep -oP '".*?"' | sort -u

# Scripts para SMB
nmap -p 445 10.10.10.50 --script=smb-vuln* -o nmap_smb.txt

# Verificar firma SMB (para Pass-the-Hash)
nmap --script=smb2-security-mode.nse -p445 10.10.10.5

# Enumerar plugins de WordPress
nmap -p80 domain.htb \
  --script http-wordpress-enum \
  --script-args http-wordpress-enum.root='/wordpress',search-limit=1000
```

**ğŸ“š CategorÃ­as Ãºtiles de scripts NSE**:
- `auth`: AutenticaciÃ³n
- `default`: Scripts seguros ejecutados con -sC
- `discovery`: Descubrimiento de informaciÃ³n
- `exploit`: Exploits (usar con precauciÃ³n)
- `vuln`: DetecciÃ³n de vulnerabilidades

---

### Transformar salida XML de Nmap a HTML

```bash
# Generar reporte HTML visual
xsltproc targetedXML > output.html

# Servir con PHP
php -S 0.0.0.0:80

# Acceder: localhost/output.html

# Usar stylesheet Bootstrap personalizado
sudo nmap -sCV -p22,80,443,135,139,445,3389 172.16.236.12 \
  --stylesheet=https://raw.githubusercontent.com/honze-net/nmap-bootstrap-xsl/stable/nmap-bootstrap.xsl \
  -oX targetedXML

# O usando variable de entorno
export NBTSTRAP="https://raw.githubusercontent.com/honze-net/nmap-bootstrap-xsl/stable/nmap-bootstrap.xsl"
sudo nmap -sCV -p22,80,443 10.10.10.10 --stylesheet=$NBTSTRAP -oX report.xml
```

---

## ğŸ“ Mejores PrÃ¡cticas

### 1. Toma de Notas Estructurada

**Herramientas recomendadas**:
- **Obsidian**: Markdown con enlaces bidireccionales
- **CherryTree**: Notas jerÃ¡rquicas con sintaxis highlighting
- **Notion**: ColaboraciÃ³n en equipo
- **Joplin**: Alternativa open-source a Evernote

**Estructura recomendada**:
```
Proyecto/
â”œâ”€â”€ 01-Reconocimiento/
â”‚   â”œâ”€â”€ nmap-scans/
â”‚   â”œâ”€â”€ subdominios.txt
â”‚   â””â”€â”€ notas-iniciales.md
â”œâ”€â”€ 02-Enumeracion/
â”‚   â”œâ”€â”€ servicios/
â”‚   â””â”€â”€ credenciales-encontradas.txt
â”œâ”€â”€ 03-Explotacion/
â”‚   â”œâ”€â”€ exploits-usados/
â”‚   â””â”€â”€ accesos-obtenidos.md
â”œâ”€â”€ 04-Post-Explotacion/
â”‚   â”œâ”€â”€ hashes/
â”‚   â”œâ”€â”€ loot/
â”‚   â””â”€â”€ persistencia.md
â””â”€â”€ 05-Evidencias/
    â”œâ”€â”€ screenshots/
    â””â”€â”€ network-captures/
```

---

### 2. GestiÃ³n de Resultados

```bash
# Crear estructura automÃ¡ticamente
mkdir -p target-{recon,enum,exploit,post,evidence}/{nmap,web,smb,misc}

# Nombrar archivos con timestamps
echo "10.10.10.10" | tee target-recon/ip.txt
nmap -sCV -p- 10.10.10.10 -oA target-recon/nmap/full-scan-$(date +%Y%m%d-%H%M)

# Extraer puertos de escaneo grepable
grep -oP '\d+/open' allPorts | cut -d'/' -f1 | tr '\n' ',' | sed 's/,$//'
```

---

### 3. AutomatizaciÃ³n con Scripts

**Script de escaneo inicial**:
```bash
#!/bin/bash
# auto-recon.sh

TARGET=$1
WORKDIR="recon-$(date +%Y%m%d-%H%M)"

mkdir -p $WORKDIR/{nmap,web}

echo "[+] Escaneando todos los puertos..."
sudo nmap -p- --open -sS --min-rate 5000 -n -Pn $TARGET -oG $WORKDIR/nmap/all-ports.gnmap

PORTS=$(grep -oP '\d+/open' $WORKDIR/nmap/all-ports.gnmap | cut -d'/' -f1 | tr '\n' ',' | sed 's/,$//')

echo "[+] Puertos encontrados: $PORTS"
echo "[+] Escaneo detallado..."

sudo nmap -sCV -A -p$PORTS $TARGET -oA $WORKDIR/nmap/detailed

echo "[+] Escaneo completado. Resultados en $WORKDIR/"
```

---

### 4. Seguridad Operacional (OpSec)

**Consideraciones para Red Team**:
- âœ… Usar VPN/Proxy para ofuscar origen
- âœ… Rotar User-Agents en fuzzing web
- âœ… Limitar velocidad de escaneo (evitar DoS accidental)
- âœ… Usar horas de menor actividad
- âœ… Monitorear si el objetivo tiene honeypots/canaries

**Niveles de sigilo en Nmap**:
```bash
# Paranoid (-T0): Espera 5 minutos entre paquetes
nmap -T0 -p- target.com

# Sneaky (-T1): Espera 15 segundos entre paquetes
nmap -T1 -sS target.com

# Polite (-T2): Reduce carga en red objetivo
nmap -T2 target.com

# Normal (-T3): Por defecto, balance entre velocidad y sigilo
nmap -T3 target.com

# Aggressive (-T4): Recomendado para redes rÃ¡pidas y confiables
nmap -T4 -sCV target.com

# Insane (-T5): Muy rÃ¡pido, puede perder puertos
nmap -T5 target.com
```

---

## ğŸ“ Tips para OSCP/Certificaciones

### Estrategia de Examen

1. **Primeros 15 minutos**: Escaneo completo de todas las mÃ¡quinas
2. **Siguientes 30 minutos**: AnÃ¡lisis de resultados y priorizaciÃ³n
3. **Resto del tiempo**: ExplotaciÃ³n metodolÃ³gica

**PriorizaciÃ³n**:
- Buffer Overflow (si aplica): 25 puntos garantizados
- MÃ¡quinas de 20 puntos: Mayor superficie de ataque
- MÃ¡quinas de 10 puntos: Ãšltima opciÃ³n

### Comandos RÃ¡pidos

```bash
# Escaneo rÃ¡pido top 1000 puertos
nmap -T4 -sC -sV --open 10.10.10.x

# Si no hay tiempo, solo esto
nmap -T5 -p- --min-rate 10000 10.10.10.x

# Enumerar TODO en servicios web
feroxbuster -u http://10.10.10.x -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 50
```

---

## ğŸ“š Referencias y Recursos

### EstÃ¡ndares y Frameworks
- [PTES - Penetration Testing Execution Standard](http://www.pentest-standard.org/)
- [OWASP Testing Guide](https://owasp.org/www-project-web-security-testing-guide/)
- [MITRE ATT&CK](https://attack.mitre.org/)
- [NIST SP 800-115](https://csrc.nist.gov/publications/detail/sp/800-115/final)

### Wordlists
- [SecLists](https://github.com/danielmiessler/SecLists)
- [FuzzDB](https://github.com/fuzzdb-project/fuzzdb)
- [PayloadsAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings)

### Herramientas
- [Nmap](https://nmap.org/)
- [Masscan](https://github.com/robertdavidgraham/masscan)
- [Rustscan](https://github.com/RustScan/RustScan)
- [FFuf](https://github.com/ffuf/ffuf)
- [Feroxbuster](https://github.com/epi052/feroxbuster)

---

## ğŸ” MITRE ATT&CK Mapping

Esta metodologÃ­a cubre las siguientes tÃ¡cticas de MITRE ATT&CK:

- **TA0043**: Reconnaissance
  - T1595: Active Scanning
  - T1592: Gather Victim Host Information

- **TA0001**: Initial Access
  - T1190: Exploit Public-Facing Application
  - T1133: External Remote Services

---

## âš–ï¸ Consideraciones Legales

**âš ï¸ IMPORTANTE**:
- âœ… Obtener **autorizaciÃ³n por escrito** antes de cualquier test
- âœ… Respetar el **alcance definido** (scope)
- âœ… No realizar pruebas en producciÃ³n sin aprobaciÃ³n
- âœ… Tener **seguro de responsabilidad civil**
- âŒ **NUNCA** realizar pentesting sin autorizaciÃ³n (es ilegal)

---

## ğŸ“Œ ConclusiÃ³n

Una metodologÃ­a sÃ³lida es la base de cualquier pentesting efectivo. Esta guÃ­a cubre los fundamentos del reconocimiento y enumeraciÃ³n inicial, que son crÃ­ticos para identificar vectores de ataque.

**PrÃ³ximos pasos**:
- Revisar [EnumeraciÃ³n de Redes](/posts/enumeracion-redes/) para tÃ©cnicas avanzadas
- Practicar en plataformas legales: HackTheBox, TryHackMe, PentesterLab

---

**Ãšltima actualizaciÃ³n**: 2025-12-10
**Licencia**: Creative Commons BY-NC-SA 4.0
